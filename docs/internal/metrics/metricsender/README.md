<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# metricsender

```go
import "github.com/aaronlmathis/gosight-agent/internal/metrics/metricsender"
```

SPDX\-License\-Identifier: GPL\-3.0\-or\-later

Copyright \(C\) 2025 Aaron Mathis aaron.mathis@gmail.com

This file is part of GoSight.

GoSight is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or \(at your option\) any later version.

GoSight is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with GoSight. If not, see https://www.gnu.org/licenses/.

## Index

- [func AppendMetricsToFile\(payload \*model.MetricPayload, filename string\) error](<#AppendMetricsToFile>)
- [type MetricSender](<#MetricSender>)
  - [func NewSender\(ctx context.Context, cfg \*config.Config\) \(\*MetricSender, error\)](<#NewSender>)
  - [func \(s \*MetricSender\) Close\(\) error](<#MetricSender.Close>)
  - [func \(s \*MetricSender\) SendMetrics\(payload \*model.MetricPayload\) error](<#MetricSender.SendMetrics>)
  - [func \(s \*MetricSender\) StartWorkerPool\(ctx context.Context, queue \<\-chan \*model.MetricPayload, workerCount int\)](<#MetricSender.StartWorkerPool>)


<a name="AppendMetricsToFile"></a>
## func [AppendMetricsToFile](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/debugging.go#L35>)

```go
func AppendMetricsToFile(payload *model.MetricPayload, filename string) error
```

AppendMetricsToFile appends the given MetricPayload to a file in JSON format. It creates the directory if it doesn't exist. The file is opened in append mode, and the payload is written as a newline\-delimited JSON object. This is useful for debugging purposes, allowing you to inspect the metrics being sent.

<a name="MetricSender"></a>
## type [MetricSender](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/sender.go#L49-L61>)

MetricSender handles OTLP metrics and control commands via dual connections.

```go
type MetricSender struct {
    // contains filtered or unexported fields
}
```

<a name="NewSender"></a>
### func [NewSender](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/sender.go#L64>)

```go
func NewSender(ctx context.Context, cfg *config.Config) (*MetricSender, error)
```

NewSender returns immediately and starts a background connection manager.

<a name="MetricSender.Close"></a>
### func \(\*MetricSender\) [Close](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/sender.go#L252>)

```go
func (s *MetricSender) Close() error
```

Close waits for any in\-flight work then closes the connection.

<a name="MetricSender.SendMetrics"></a>
### func \(\*MetricSender\) [SendMetrics](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/sender.go#L191>)

```go
func (s *MetricSender) SendMetrics(payload *model.MetricPayload) error
```

SendMetrics converts to OTLP and sends via unary call.

<a name="MetricSender.StartWorkerPool"></a>
### func \(\*MetricSender\) [StartWorkerPool](<https://github.com/aaronlmathis/gosight-agent/blob/main/internal/metrics/metricsender/task.go#L43>)

```go
func (s *MetricSender) StartWorkerPool(ctx context.Context, queue <-chan *model.MetricPayload, workerCount int)
```

StartWorkerPool launches N workers and processes metric payloads with retries in case of transient errors. Each worker will attempt to send the payload to the gRPC server. The number of workers is determined by the workerCount parameter. The workers will run until the context is done or an error occurs. The function uses a goroutine for each worker, allowing them to run concurrently.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
